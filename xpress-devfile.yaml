---
apiVersion: 1.0.0
metadata:
  name: xpress
attributes:
  persistVolumes: 'false'
components:
  - type: cheEditor
    reference: >-
      https://raw.githubusercontent.com/mplab-xpresside/devfiles/refs/heads/master/meta-mplab-xpresside.yaml
  - type: chePlugin
    alias: my-rest-plugin
    reference: >-
      https://raw.githubusercontent.com/mplab-xpresside/devfiles/refs/heads/master/meta-xpress-rest.yaml
  - alias: mcc
    type: dockerimage
    image: "636541044155.dkr.ecr.us-west-2.amazonaws.com/xpress/prod/mcc:5.5.1"
    volumes:
      - name: xpressprojects
        containerPath: /home/projects
    endpoints:
      - name: mcc-view-server
        port: 2000
        attributes:
           protocol: http
           secure: 'false'
      - name: mcc-websocket-server
        port: 30001
        attributes:
           protocol: ws
           secure: 'false'
    memoryLimit: "2Gi"
    memoryRequest: "512Mi"
commands:
  - name: >
      xclm: license server activation
    actions:
      - type: exec
        component: my-rest-plugin
        command: >
          /opt/microchip/xc8/v3.00/bin/xclm -netfile 5053 licenses.microchip.com && 
          /opt/microchip/xc16/v2.10/bin/xclm -netfile 5053 licenses.microchip.com && 
          /opt/microchip/xc-dsc/v3.21/bin/xclm -netfile 5053 licenses.microchip.com && 
          /opt/microchip/xc32/v4.60/bin/xclm -netfile 5053 licenses.microchip.com
        
